<div class="card" id="display" style="border: 2px solid #333; transition: 0.5s;">
    <div id="status_scan" style="font-size: 10px; color: var(--g); text-shadow: 0 0 5px gold;">üõ∞Ô∏è SCANNER DE PROXIMIDADE ATIVO</div>
    
    <div style="width: 100%; background: #000; height: 10px; border-radius: 5px; margin: 10px 0; border: 1px solid #222;">
        <div id="progress_bar" style="width: 10%; height: 100%; background: var(--s); transition: 1s; border-radius: 5px;"></div>
    </div>

    <div id="rosa_timer" class="rosa-alert" style="font-size: 20px;">üéØ ALVO IDENTIFICADO: ROSA IMINENTE!</div>
    <div class="metric" id="ui_lib" style="font-size: 35px;">0%</div>
    <div id="ui_stake" style="background:#222; padding:12px; border-radius:4px; border: 1px solid var(--g); font-weight: bold; color: #fff;">AGUARDANDO CICLO...</div>
</div>

<script>
    function iniciarAnalise() {
        const lastRosaMin = parseInt(document.getElementById('last_rosa').value);
        const log = document.getElementById('log');
        const display = document.getElementById('display');
        const bar = document.getElementById('progress_bar');
        
        if(isNaN(lastRosaMin)) { alert("Insira o minuto da √∫ltima Rosa!"); return; }

        document.getElementById('status_scan').innerText = "CALCULANDO CRUZAMENTO DE DADOS...";
        
        setTimeout(() => {
            const currentMin = new Date().getMinutes();
            let gap = 12; // M√©dia de recarga padr√£o
            let proximaJanela = (lastRosaMin + gap) % 60;
            
            // C√°lculo de dist√¢ncia
            let diff = proximaJanela - currentMin;
            if (diff < 0) diff += 60;

            // N√≠vel de Carga do Balde (0 a 100%)
            let carga = Math.min(100, Math.max(0, (1 - (diff / gap)) * 100));
            bar.style.width = carga + "%";

            if (diff <= 2 || diff >= 58) {
                // ESTADO DE ROSA
                display.style.borderColor = "#ff00ff";
                display.style.boxShadow = "0 0 20px #ff00ff";
                document.getElementById('rosa_timer').style.display = "block";
                document.getElementById('ui_lib').innerText = "LIBERADO: 99%";
                document.getElementById('ui_stake').innerText = "DITAR STAKE: 1 Real";
                document.getElementById('ui_lib').style.color = "#ff00ff";
                log.innerText = "CERCO FECHADO. O servidor atingiu o ponto de satura√ß√£o.";
            } else {
                // ESTADO DE ACUMULA√á√ÉO
                display.style.borderColor = "#333";
                display.style.boxShadow = "none";
                document.getElementById('rosa_timer').style.display = "none";
                document.getElementById('ui_lib').innerText = "PENDENTE: " + Math.floor(carga) + "%";
                document.getElementById('ui_stake').innerText = "DITAR STAKE: 10 cents";
                document.getElementById('ui_lib').style.color = "var(--s)";
                log.innerText = "Aguardando recarga. Pr√≥xima janela em " + diff + " minutos.";
            }
        }, 1200);
    }
                </script>
                
