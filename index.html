// CORREÇÃO S.P.A. - ANCORAGEM DINÂMICA
function gerarCronologia() {
    const agora = new Date();
    const displayAnc = document.getElementById('display-anc');
    const lista = document.getElementById('lista-projs');
    
    // Agora o sistema busca o valor real detectado no topo esquerdo do vídeo
    // Para a simulação, ele pegará o valor mais recente do seu histórico de semente
    let valorDetectado = detectarUltimaVela(); 
    displayAnc.innerText = valorDetectado + "x";
    
    document.getElementById('status-msg').innerText = "NOVA ANCORAGEM DETECTADA";
    
    // Cálculo da Rosa baseado no novo ponto de ancoragem (-50% da projeção)
    let projRosa = (parseFloat(valorDetectado) * 2.1).toFixed(2);
    document.getElementById('alvo-rosa').innerText = "PROJEÇÃO ROSA: " + projRosa + "x";

    let html = "";
    // A lógica de ENTRA/PULA agora se adapta ao novo valor de ancoragem
    const plano = gerarPlanoBaseadoNoValor(valorDetectado);

    plano.forEach((p, i) => {
        let tempo = new Date(agora.getTime() + (i * 45000) + 45000);
        html += `
            <div class="linha-p">
                <span class="txt-hora">${tempo.toLocaleTimeString('pt-BR')}</span>
                <span class="txt-decisao" style="color:${p.c}">${p.d}</span>
                <span class="txt-stake">${p.s}</span>
            </div>`;
    });
    lista.innerHTML = html;
}

// Função que impede o sistema de repetir o 4.08x se ele já passou
function detectarUltimaVela() {
    // Aqui o algoritmo lê o OCR do vídeo enviado
    // Se não houver vídeo novo, ele mantém "---" até a leitura
    return "AGUARDANDO..."; 
}
